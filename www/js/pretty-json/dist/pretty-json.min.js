var PrettyJSON={view:{},tpl:{}};PrettyJSON.util={isObject:function(v){return Object.prototype.toString.call(v)==="[object Object]"},pad:function(str,length){str=String(str);while(str.length<length)str="0"+str;return str},dateFormat:function(date,f){f=f.replace("YYYY",date.getFullYear());f=f.replace("YY",String(date.getFullYear()).slice(-2));f=f.replace("MM",PrettyJSON.util.pad(date.getMonth()+1,2));f=f.replace("DD",PrettyJSON.util.pad(date.getDate(),2));f=f.replace("HH24",PrettyJSON.util.pad(date.getHours(),2));f=f.replace("HH",PrettyJSON.util.pad(date.getHours()%12,2));f=f.replace("MI",PrettyJSON.util.pad(date.getMinutes(),2));f=f.replace("SS",PrettyJSON.util.pad(date.getSeconds(),2));return f}};PrettyJSON.tpl.Node=""+'<div class="node-container">'+'<span class="node-top node-bracket" />'+'<div class="node-content-wrapper">'+'<ul class="node-body" />'+"</div>"+'<span class="node-down node-bracket" />'+"</div>";PrettyJSON.tpl.Leaf=""+'<div class="leaf-container">'+'<span class="<%= type %>"> <%=data%></span><span><%= coma %></span>'+"</div>";PrettyJSON.view.Leaf=function(opt){this.el=$("<span></span>");this.tagName="span";this.options=opt;this.data=_.isUndefined(this.options.data)?null:this.options.data;this.level=_.isUndefined(this.options.level)?0:this.options.level;this.path=this.options.path||"";this.type=this.getType()||"string";this.dateFormat=this.options.dateFormat;this.isLast=_.isUndefined(this.options.isLast)?true:this.options.isLast;this.render()};PrettyJSON.view.Leaf.prototype.getType=function(){var m="string";var d=this.data;if(_.isNumber(d))m="number";else if(_.isBoolean(d))m="boolean";else if(_.isDate(d))m="date";else if(_.isNull(d))m="null";return m};PrettyJSON.view.Leaf.prototype.getState=function(){var coma=this.isLast?"":",";var state={data:this.data,level:this.level,path:this.path,type:this.type,coma:coma};return state};PrettyJSON.view.Leaf.prototype.render=function(){var state=this.getState(),quotation='"';if(state.type=="date"&&this.dateFormat){state.data=quotation+PrettyJSON.util.dateFormat(this.data,this.dateFormat)+quotation}else if(state.type=="string"){state.data=quotation+state.data+quotation}else if(state.type=="null"){state.data="null"}this.tpl=_.template(PrettyJSON.tpl.Leaf);$(this.el).html(this.tpl(state));return this};PrettyJSON.view.Node=function(opt){if(!opt.el){this.$el=$("<span></span>");this.el=this.$el[0]}else{this.$el=opt.el instanceof $?opt.el:$(opt.el);this.el=this.$el[0]}this.tagName="span";this.options=opt;this.data=this.options.data||null;this.level=this.options.level||1;this.path=this.options.path||"";this.isLast=_.isUndefined(this.options.isLast)?true:this.options.isLast;this.rendered=false;this.dateFormat=this.options.dateFormat;var m=this.getMeta();this.type=m.type;this.size=m.size;this.childs=[];this.render();this.show()};PrettyJSON.view.Node.prototype.getMeta=function(){var val={size:_.size(this.data),type:_.isArray(this.data)?"array":"object"};return val};PrettyJSON.view.Node.prototype.elements=function(){this.els={container:$(this.el).find(".node-container"),contentWrapper:$(this.el).find(".node-content-wrapper"),top:$(this.el).find(".node-top"),ul:$(this.el).find(".node-body"),down:$(this.el).find(".node-down")}};PrettyJSON.view.Node.prototype.render=function(){this.tpl=_.template(PrettyJSON.tpl.Node);$(this.el).html(this.tpl);this.elements();var b=this.getBrackets();this.els.top.html(b.top);this.els.down.html(b.bottom);return this};PrettyJSON.view.Node.prototype.renderChilds=function(){var count=1;_.forEach(this.data,function(val,key){var isLast=count==this.size;count=count+1;var path=this.type=="array"?this.path+"["+key+"]":this.path+"."+key;var opt={key:key,data:val,parent:this,path:path,level:this.level+1,dateFormat:this.dateFormat,isLast:isLast};var child=PrettyJSON.util.isObject(val)||_.isArray(val)?new PrettyJSON.view.Node(opt):new PrettyJSON.view.Leaf(opt);var li=$("<li/>");var quotation='"';var colom="&nbsp;:&nbsp;";var left=$("<span />");var right=$("<span />").append(child.el);this.type=="array"?left.html(""):left.html(quotation+key+quotation+colom);left.append(right);li.append(left);this.els.ul.append(li);child.parent=this;this.childs.push(child)}.bind(this))};PrettyJSON.view.Node.prototype.show=function(){if(!this.rendered){this.renderChilds();this.rendered=true}this.els.top.html(this.getBrackets().top);this.els.contentWrapper.show();this.els.down.show()};PrettyJSON.view.Node.prototype.getBrackets=function(){var v={top:"{",bottom:"}"};if(this.type=="array"){v={top:"[",bottom:"]"}}v.bottom=this.isLast?v.bottom:v.bottom+",";return v};PrettyJSON.view.Node.prototype.expandAll=function(){_.forEach(this.childs,function(child){if(child instanceof PrettyJSON.view.Node){child.show();child.expandAll()}}.bind(this));this.show()};